name: 主工作流
on:
  push:
    branches:
      - main

jobs:
  version-check-and-build:
    name: 版本检查与构建
    uses: ./.github/workflows/版本检查与构建.yml
    secrets: inherit
  release-management:
    name: 发布管理
    needs: version-check-and-build
    if: needs.version-check-and-build.outputs.is_new_version == 'true' && needs.version-check-and-build.outputs.tag_exists == 'false'
    uses: ./.github/workflows/发布管理.yml
    with:
      version: ${{ needs.version-check-and-build.outputs.version }}
      changelog: ${{ needs.version-check-and-build.outputs.changelog }}
      build-path: ${{ needs.version-check-and-build.outputs.build_path }}
    secrets: inherit
